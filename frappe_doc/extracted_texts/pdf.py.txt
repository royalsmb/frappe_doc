import frappe
from frappe.utils.print_format import download_pdf, download_multi_pdf
import json
from frappe.utils import get_files_path
import os
from frappe.utils.pdf import get_pdf


@frappe.whitelist()
def enquue_generate_pdf(doc, method=None):
    frappe.enqueue('wsc.utils.pdf.generate_pdf_url', doc=doc)

@frappe.whitelist()
def generate_pdf_url():
    shift = frappe.get_doc("POS Shift", {"user": frappe.session.user, "status": "Open"}, "name")
    profile_doc = frappe.get_doc("POS Profile", shift.pos_profile)

    data = frappe.request.args
    order_id = data.get("order_id")
    doctype = "Sales Invoice"  
    
    format = profile_doc.print_format
    no_letterhead = 0
    language = None
    letterhead = None
    download_pdf(doctype, order_id, format, no_letterhead, language, letterhead)

    # Access the PDF content from the response
    pdf_content = frappe.local.response.filecontent
    return pdf_content

    # Construct the filename and filepath
    filename = "{name}.pdf".format(name=order_id.replace(" ", "-").replace("/", "-"))
    filepath = os.path.join(get_files_path(), filename)

    _file = frappe.get_doc({
        "doctype": "File",
        "file_name": filename,
        "is_private": 0,
        "content": pdf_content
    })
    return _file