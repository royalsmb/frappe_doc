import{_ as C}from"./AddCardModal-3c9bafc7.js";import{_ as A,o as n,c as m,a as l,r as B,k as g,j as V,f as c,ad as D,n as M,d as s,e as a,w as r,b as u,g as v,F as b,l as y,q as N,s as R,t as S,v as j}from"./index-aee75141.js";import{_ as L,b as T,a as z}from"./Tooltip.vue_vue_type_script_setup_true_lang-602230f1.js";import{_ as E,a as F,b as I,c as P,d as U}from"./ListView-f81a1206.js";import{a as Z}from"./CardForm-5ad2b621.js";const q={},G={width:"16",height:"16",fill:"none",viewBox:"0 0 16 16"};function H(x,o){return n(),m("svg",G,o[0]||(o[0]=[l("g",{class:"es-line-reload","clip-path":"url(#a)"},[l("path",{fill:"currentColor","fill-rule":"evenodd",d:"M9.743 2.189a6 6 0 0 0-6.558 2.596.5.5 0 0 0 .844.535 5 5 0 0 1 9.12 1.683l-1.187-.686a.5.5 0 0 0-.5.866l2.165 1.25a.5.5 0 0 0 .683-.183l1.25-2.165a.5.5 0 0 0-.866-.5l-.603 1.044a6 6 0 0 0-4.348-4.44ZM3.356 9.024l1.189.687a.5.5 0 0 0 .5-.866L2.88 7.595a.5.5 0 0 0-.683.183L.947 9.943a.5.5 0 1 0 .866.5l.603-1.044a6 6 0 0 0 10.9 1.816.5.5 0 0 0-.844-.536 5 5 0 0 1-9.116-1.655Z",class:"Union","clip-rule":"evenodd"})],-1),l("defs",null,[l("clipPath",{id:"a",class:"a"},[l("path",{fill:"currentColor",d:"M.25 0h16v16h-16z"})])],-1)]))}const J=A(q,[["render",H]]),K={class:"flex h-10.5 border-b items-center justify-between py-2 px-5 shrink-0"},O={class:"flex flex-col overflow-hidden mx-60 mt-6"},Q={class:"flex justify-end gap-2 mb-3"},W={key:0,class:"flex items-center gap-2 text-base"},X={class:"flex items-center rounded bg-gray-100 px-1 py-0.5 hover:bg-gray-200"},Y={key:1,class:"h-60 border border-dashed rounded"},ee={class:"flex flex-col gap-2 items-center justify-center h-full"},oe={__name:"Cards",setup(x){const o=B(!1),i=g({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.get_payment_methods"},cache:"cards",auto:!0}),k=[{label:"Name on Card",key:"name_on_card"},{label:"Card",key:"last_4",width:1.3},{label:"Expiry",key:"expiry_month",width:.7},{label:"Mandated",key:"stripe_mandate_id",align:"center",width:.5},{label:"",key:"alert",align:"right",width:.3},{label:"",key:"creation",align:"right",width:.7},{label:"",key:"actions",align:"right",width:.3}],f=V(()=>i.data?i.data.map(e=>({id:e.name,name_on_card:e.name_on_card,last_4:{brand:e.brand,last_4:`•••• ${e.last_4}`,default:e.is_default},expiry_month:`${e.expiry_month<10?`0${e.expiry_month}`:e.expiry_month}/${e.expiry_year}`,stripe_mandate_id:e.stripe_mandate_id?h(c,{name:"check-circle",class:"h-4 w-4 text-green-600"}):null,alert:e.is_default&&e.stripe_payment_method?h(L,{text:"The last payment failed on this card. Please use a different card."},()=>h(c,{name:"alert-circle",class:"h-4 w-4 text-red-600"})):null,creation:D(e.creation).value,actions:{is_default:e.is_default,options:[{label:"Set as default",onClick:()=>w(e.name),condition:()=>!e.is_default},{label:"Remove",onClick:()=>$(e.name)}]}})):[]),w=e=>{g({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.set_as_default",data:{name:e}},auto:!0,onSuccess:()=>{i.reload()}})},$=e=>{M({title:"Remove Card",message:"Are you sure you want to remove this card?",actions:[{label:"Remove",variant:"solid",theme:"red",onClick:t=>{g({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.remove_payment_method",data:{name:e}},auto:!0,onSuccess:()=>{i.reload(),t()}})}}]})};return(e,t)=>(n(),m(b,null,[l("header",K,[s(a(T),{items:[{label:"Cards"}]})]),l("div",O,[l("div",Q,[s(a(y),{loading:a(i).loading,onClick:t[0]||(t[0]=d=>a(i).reload())},{icon:r(()=>[s(J,{class:"h-4 w-4"})]),_:1},8,["loading"]),s(a(y),{label:"Add Card",variant:"solid",onClick:t[1]||(t[1]=d=>o.value=!0)},{prefix:r(()=>[s(a(c),{name:"plus",class:"h-4 w-4"})]),_:1})]),s(a(I),{columns:k,rows:f.value,"row-key":"id",options:{selectable:!1,showTooltip:!1}},{default:r(()=>[s(a(E)),f.value.length?(n(),u(a(F),{key:0},{default:r(()=>[(n(!0),m(b,null,N(f.value,d=>(n(),u(a(P),{key:d.id,row:d},{default:r(({column:p,item:_})=>[s(a(U),{item:_,align:p.align},{default:r(()=>[p.key=="last_4"?(n(),m("div",W,[(n(),u(R(a(Z)(_.brand)),{class:"h-6 w-6"})),l("div",null,S(_.last_4),1),_.default?(n(),u(a(z),{key:0,label:"Default",variant:"outline",theme:"green"})):v("",!0)])):p.key=="actions"&&!_.is_default?(n(),u(a(j),{key:1,options:_.options},{default:r(()=>[l("button",X,[s(a(c),{name:"more-horizontal",class:"h-4 w-4"})])]),_:2},1032,["options"])):v("",!0)]),_:2},1032,["item","align"])]),_:2},1032,["row"]))),128))]),_:1})):(n(),m("div",Y,[l("div",ee,[t[5]||(t[5]=l("p",{class:"text-lg text-gray-500"},"No card found",-1)),s(a(y),{label:"Add Card",variant:"outline",onClick:t[2]||(t[2]=d=>o.value=!0)},{prefix:r(()=>[s(a(c),{name:"plus",class:"h-4 w-4"})]),_:1})])]))]),_:1},8,["rows"])]),o.value?(n(),u(C,{key:0,modelValue:o.value,"onUpdate:modelValue":t[3]||(t[3]=d=>o.value=d),onSuccess:t[4]||(t[4]=()=>{o.value=!1,a(i).reload()})},null,8,["modelValue"])):v("",!0)],64))}};export{oe as default};
//# sourceMappingURL=Cards-7955ca22.js.map
