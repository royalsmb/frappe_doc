import{k as c,j as D,c as f,a as w,d as s,e as n,w as l,F as b,i as F,o as i,q as T,b as u,ab as j,g as d,l as h,ac as y,f as k}from"./index-aee75141.js";import{b as P,a as B}from"./Tooltip.vue_vue_type_script_setup_true_lang-602230f1.js";import{_ as Y,a as v,b as E,c as O,d as R}from"./ListView-f81a1206.js";const V={class:"flex h-10.5 border-b items-center justify-between py-2 px-5 shrink-0"},q={class:"flex flex-col overflow-hidden px-60 pt-6"},G={__name:"Invoices",setup(z){const p=F("team"),g=c({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.get_invoices"},cache:"invoices",auto:!0}),S=[{label:"Invoice",key:"name",width:1.2},{label:"Status",key:"status",width:.8},{label:"Period",key:"due_date",width:1.5},{label:"Total",key:"total",width:1},{label:"",key:"button",width:1,align:"right"}],_=D(()=>{var a;return p.data?(a=g.data)==null?void 0:a.map(e=>{let t="Prepaid Credits";e.type=="Subscription"&&(t=new Date(e.period_end).toLocaleString("en-US",{month:"long",year:"numeric"}));let o=new Date(e.due_date).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric"});if(e.type=="Subscription"){let r=new Date(e.period_start),m=new Date(e.period_end),L=r.getFullYear()===m.getFullYear()?r.toLocaleString("en-US",{month:"short",day:"numeric"}):r.toLocaleString("en-US",{dateStyle:"short"}),I=m.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric"});o=`${L} - ${I}`}return{id:e.name,name:t,status:{label:e.status,color:e.status==="Paid"?"green":e.status=="Unpaid"?"orange":"gray"},due_date:o,total:C(e.total),button:{url:e.invoice_pdf,download:()=>$(e.name),status:e.status,amount_due:e.amount_due,payNow:()=>x(e)}}}):[]});function x(a){a.stripe_invoice_url?window.open(a.stripe_invoice_url,"_blank"):c({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.get_stripe_payment_url_for_invoice",data:{name:a.name}},auto:!0,onSuccess:e=>window.open(e,"_blank")})}function $(a){c({url:"frappe.integrations.frappe_providers.frappecloud_billing.get_token_and_base_url",auto:!0,onSuccess:e=>{fetch(`${e.base_url}/api/method/press.saas.api.billing.download_invoice`,{method:"POST",headers:{"Content-Type":"application/json","X-Site-Access-Token":e.token},body:JSON.stringify({name:a})}).then(t=>{if(!t.ok)throw new Error("Network response was not ok "+t.statusText);return t.blob()}).then(t=>{const o=window.URL.createObjectURL(t);window.open(o,"_blank")}).catch(t=>{console.error("There was a problem with the fetch operation:",t)})}})}function C(a){return a===0?"":N(a)}function U(a,e,t=2){return new Intl.NumberFormat("en-US",{style:"currency",currency:e,maximumFractionDigits:t}).format(a)}function N(a,e=2){var t;return U(a,(t=p.data)==null?void 0:t.currency,e)}return(a,e)=>(i(),f(b,null,[w("header",V,[s(n(P),{items:[{label:"Invoices"}]})]),w("div",q,[s(n(E),{columns:S,rows:_.value,"row-key":"id",options:{selectable:!1}},{default:l(()=>[s(n(Y)),s(n(v),null,{default:l(()=>[(i(!0),f(b,null,T(_.value,t=>(i(),u(n(O),{key:t.id,row:t},{default:l(({column:o,item:r})=>[s(n(R),{item:r,align:o.align},{prefix:l(()=>[o.key=="name"?(i(),u(j,{key:0,class:"h-4"})):d("",!0)]),default:l(()=>[o.key=="status"?(i(),u(n(B),{key:0,label:r.label,variant:"subtle",theme:r.color,size:"md"},null,8,["label","theme"])):d("",!0),o.key=="button"&&r.status=="Unpaid"&&r.amount_due>0?(i(),u(n(h),{key:1,label:"Pay now",onClick:y(r.payNow,["stop"])},{prefix:l(()=>[s(n(k),{name:"external-link",class:"h-4 w-4"})]),_:2},1032,["onClick"])):o.key=="button"&&r.url?(i(),u(n(h),{key:2,label:"Download",onClick:y(r.download,["stop"])},{prefix:l(()=>[s(n(k),{name:"download",class:"h-4 w-4"})]),_:2},1032,["onClick"])):d("",!0)]),_:2},1032,["item","align"])]),_:2},1032,["row"]))),128))]),_:1})]),_:1},8,["rows"])])],64))}};export{G as default};
//# sourceMappingURL=Invoices-00ce0bd8.js.map
