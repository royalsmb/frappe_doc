var A=Object.defineProperty;var W=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var I=(r,a,t)=>a in r?A(r,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[a]=t,D=(r,a)=>{for(var t in a||(a={}))T.call(a,t)&&I(r,t,a[t]);if(W)for(var t of W(a))q.call(a,t)&&I(r,t,a[t]);return r};import{d as G,r as d,v as K,c as V,E as O,bK as U,D as H,C as J,a as _,f as m,k as c,w as b,u as v,F as Q,m as X,n as E,g as j,aR as Y,j as P,cV as Z,dG as ee,o as y,e as S,l as te,t as se,I as ae}from"./index-BjEuYp6c.js";import{_ as F}from"./PanelResizer.vue_vue_type_script_setup_true_lang-BduBo3MG.js";const ie={class:"flex h-screen flex-col items-center bg-surface-white py-2"},ne={class:"relative flex w-full items-center justify-center"},oe={class:"flex gap-1"},re=["onClick"],le=m("div",{class:"resize-handler-left h-full w-2 rounded-sm bg-surface-gray-2"},null,-1),de=["src"],ue={key:1,class:"absolute flex h-full w-full items-center justify-center"},ce=m("div",{class:"resize-handler-left h-full w-2 rounded-sm bg-surface-gray-2"},null,-1),R=400,pe=G({__name:"PagePreview",setup(r){const a=Z(),t=window.innerWidth*.92;let k=d("");const n=d(t),x=d(!1),p=K(),f=d(!1),h=[{icon:"monitor",device:"desktop",width:1400},{icon:"tablet",device:"tablet",width:800},{icon:"smartphone",device:"mobile",width:420}],z=d(null),C=d(null),M=V(()=>{var s,e;return((s=z.value)==null?void 0:s.dragActive)||((e=C.value)==null?void 0:e.dragActive)}),B=V(()=>{const s=h.find(i=>i.device==="tablet"),e=h.find(i=>i.device==="mobile");return n.value<=((e==null?void 0:e.width)||R)?"mobile":n.value<=((s==null?void 0:s.width)||t)?"tablet":"desktop"}),u=d(null);O(document,"keydown",s=>{s.key==="Escape"&&ee.currentRoute.value.name==="preview"&&history.back()}),U(()=>{u.value&&(x.value=!0,u.value.addEventListener("load",()=>{var s,e,i,g,w;setTimeout(()=>{x.value=!1},100),(s=u.value)==null||s.addEventListener("mousedown",l=>{document.dispatchEvent(new MouseEvent("mousedown",l))}),(i=(e=u.value)==null?void 0:e.contentWindow)==null||i.document.addEventListener("mouseup",l=>{document.dispatchEvent(new MouseEvent("mouseup",l))}),(w=(g=u.value)==null?void 0:g.contentWindow)==null||w.document.addEventListener("mousemove",l=>{document.dispatchEvent(new MouseEvent("mousemove",l))})},{once:!0}))});const N=s=>{const e=h.find(i=>i.device===s);e&&(e.device==="desktop"?n.value=t:n.value=e.width)},$=()=>{let s=D({page:a.params.pageId},p.routeVariables);k.value=`/api/method/builder.api.get_page_preview_html?${Object.entries(s).map(([e,i])=>`${e}=${i}`).join("&")}`};return H(()=>a.params.pageId,()=>{$()},{immediate:!0}),J(()=>{ae.capture("builder_page_preview_viewed")}),(s,e)=>{var l,L;const i=P("FeatherIcon"),g=P("router-link"),w=P("BuilderButton");return y(),_("div",ie,[m("div",ne,[c(g,{to:{name:"builder",params:{pageId:v(a).params.pageId||"new"}},class:"absolute left-3 flex w-fit text-sm text-ink-gray-7 hover:text-ink-gray-9"},{default:b(()=>[c(i,{name:"arrow-left",class:"mr-4 h-4 w-4 cursor-pointer"}),S(" Back to builder ")]),_:1},8,["to"]),m("div",oe,[(y(),_(Q,null,X(h,o=>m("div",{class:E(["w-auto cursor-pointer rounded-md p-1 px-[8px]",{"bg-surface-white":B.value===o.device}]),key:o.device,onClick:te(()=>N(o.device),["stop"])},[c(i,{name:o.icon,class:E(["h-6 w-5 text-ink-gray-4",{"text-ink-gray-9":B.value===o.device}])},null,8,["name","class"])],10,re)),64))]),c(w,{variant:"solid",iconLeft:"globe",onClick:e[0]||(e[0]=()=>{f.value=!0,v(p).publishPage().finally(()=>f.value=!1)}),class:E(["absolute right-3 border-0",{"bg-surface-gray-7 !text-ink-white hover:bg-surface-gray-6":!f.value&&((l=v(p).activePage)==null?void 0:l.draft_blocks),"dark:bg-surface-gray-2 dark:text-ink-gray-4":!((L=v(p).activePage)!=null&&L.draft_blocks)}]),loading:f.value},{default:b(()=>[S(se(f.value?"Publishing":"Publish"),1)]),_:1},8,["class","loading"])]),m("div",{class:"relative mt-5 flex h-[85vh] bg-white",style:Y({width:n.value+"px"})},[c(F,{class:"ml-[-12px]",side:"left",dimension:n.value,minDimension:R,maxDimension:t,resizeSensitivity:2,ref_key:"leftPanelRef",ref:z,onResize:e[1]||(e[1]=o=>n.value=o)},{default:b(()=>[le]),_:1},8,["dimension"]),v(k)?(y(),_("iframe",{key:0,src:v(k),frameborder:"0",class:"flex-1 rounded-sm",ref_key:"previewWindow",ref:u},null,8,de)):j("",!0),x.value||M.value?(y(),_("div",ue)):j("",!0),c(F,{class:"mr-[-8px]",side:"right",dimension:n.value,minDimension:R,maxDimension:t,resizeSensitivity:2,ref_key:"rightPanelRef",ref:C,onResize:e[2]||(e[2]=o=>n.value=o)},{default:b(()=>[ce]),_:1},8,["dimension"])],4)])}}});export{pe as default};
//# sourceMappingURL=PagePreview-DQrpRd8w.js.map
