import{_ as ee,o as s,c as d,a as e,m as U,u as O,b as V,w as h,d as i,e as a,f as M,g as b,D as Y,h as q,i as j,r as D,j as B,k as A,t as o,l as S,C as ae,n as G,p as H,F as z,q as te,s as J,v as K,x as le,y as T,z as se}from"./index-aee75141.js";import{_ as ne,a as ie,b as oe}from"./BillingDetails-71e8e074.js";import{c as de,S as Q,a as W}from"./CardForm-5ad2b621.js";import{_ as re,a as ue,b as pe}from"./Tooltip.vue_vue_type_script_setup_true_lang-602230f1.js";import{_ as ce}from"./AddCardModal-3c9bafc7.js";const me={},ve={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function fe(_,n){return s(),d("svg",ve,n[0]||(n[0]=[e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4 1.43311C3.17157 1.43311 2.5 2.10468 2.5 2.93311V13.9522L3.99324 12.7444C4.19295 12.5828 4.48257 12.5989 4.66319 12.7815L6.15385 14.2887L7.6445 12.7815C7.73842 12.6865 7.86643 12.6331 8 12.6331C8.13357 12.6331 8.26158 12.6865 8.3555 12.7815L9.84615 14.2887L11.3368 12.7815C11.5174 12.5989 11.807 12.5828 12.0068 12.7444L13.5 13.9522V2.9331C13.5 2.10468 12.8284 1.43311 12 1.43311H4ZM1.5 2.93311C1.5 1.55239 2.61929 0.433105 4 0.433105H12C13.3807 0.433105 14.5 1.55239 14.5 2.9331V14.9998C14.5 15.1925 14.3893 15.368 14.2154 15.451C14.0415 15.534 13.8354 15.5097 13.6855 15.3885L11.7296 13.8064L10.2017 15.3514C10.1077 15.4463 9.97972 15.4998 9.84615 15.4998C9.71259 15.4998 9.58457 15.4463 9.49065 15.3514L8 13.8442L6.50935 15.3514C6.41543 15.4463 6.28741 15.4998 6.15385 15.4998C6.02028 15.4998 5.89227 15.4463 5.79834 15.3514L4.27036 13.8064L2.31445 15.3885C2.16464 15.5097 1.95852 15.534 1.78462 15.451C1.61073 15.368 1.5 15.1925 1.5 14.9998V2.93311ZM4 5.5C4 5.22386 4.22386 5 4.5 5H11.5C11.7761 5 12 5.22386 12 5.5C12 5.77614 11.7761 6 11.5 6H4.5C4.22386 6 4 5.77614 4 5.5ZM4.5 9C4.22386 9 4 9.22386 4 9.5C4 9.77614 4.22386 10 4.5 10H11.5C11.7761 10 12 9.77614 12 9.5C12 9.22386 11.7761 9 11.5 9H4.5Z",fill:"currentColor"},null,-1)]))}const _e=ee(me,[["render",fe]]),ge={key:0,class:"inline-flex gap-1.5 text-base mb-5 text-gray-700"},X={__name:"AddPrepaidCreditsModal",props:U({showMessage:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:U(["success"],["update:modelValue"]),setup(_,{emit:n}){const y=n,v=O(_,"modelValue");return(r,u)=>(s(),V(a(Y),{modelValue:v.value,"onUpdate:modelValue":u[1]||(u[1]=p=>v.value=p),options:{title:"Add Credit Balance"}},{"body-content":h(()=>[_.showMessage?(s(),d("div",ge,[i(a(M),{class:"h-4",name:"info"}),u[2]||(u[2]=e("span",null," Add credits to your account before changing the payment mode. ",-1))])):b("",!0),i(ne,{onSuccess:u[0]||(u[0]=()=>{v.value=!1,y("success")})})]),_:1},8,["modelValue"]))}},ye={class:"flex flex-col gap-4"},xe={key:0,class:"flex justify-between shadow rounded-lg py-3 px-4 text-base"},be={class:"flex gap-3"},he={class:"flex flex-col gap-4 flex-1"},Ce={class:"flex flex-col gap-1.5"},we={class:"font-semibold text-gray-900 text-lg"},ke={key:0,class:"text-gray-700"},$e={key:0,class:"text-gray-700 inline-flex items-center gap-1.5"},Ve={key:1,class:"text-gray-700"},Me={key:1,class:"flex flex-col shadow rounded-lg text-base text-gray-900"},De={class:"flex flex-col gap-2.5 py-3 px-4"},Se={class:"flex justify-between items-center"},Pe={class:"flex flex-col gap-1.5"},Ae={class:"text-gray-700"},Be={class:"flex flex-col gap-1.5 text-end"},Ie={class:"font-semibold text-xl"},je={class:"text-gray-600"},Le={class:"flex justify-between items-center"},Ue={class:"text-gray-700 flex gap-2"},Ne={class:"text-gray-900 font-medium"},Re={key:0,class:"flex justify-between items-center rounded-lg py-2 px-2.5 m-1.5 bg-gray-50"},Ee={class:"text-gray-800 flex items-center gap-2 h-7"},Fe={key:2,class:"flex items-start justify-center"},He={__name:"CurrentPlan",emits:["changePlan"],setup(_,{emit:n}){const y=n,v=q(),r=j("team"),u=j("currentSiteInfo"),{currentBillingAmount:p,upcomingInvoice:w}=j("billing"),k=D(!1),f=D(0),x=B(()=>f.value>1?"Your trial plan ends in "+f.value+" days":"Your trial plan will end tomorrow"),m=D(null),P=B(()=>r.data.currency=="INR"?"₹":"$"),c=B(()=>{if(!u.data)return null;f.value=de(u.data.trial_end_date);let C=u.data.plan;return m.value=P.value==="₹"?C.price_inr:C.price_usd,C}),L=A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.total_unpaid_amount"},cache:"unpaidAmount",auto:!0}),F=()=>{const C=new Date;return new Date(C.getFullYear(),C.getMonth()+1,0).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})},$=A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.get_unpaid_invoices"}});function t(){r.data.payment_mode=="Prepaid Credits"?k.value=!0:g()}async function g(){let C=await $.reload();if(C.length>1)G({title:"Multiple unpaid invoices",message:"You have multiple unpaid invoices. Please pay them from the invoices page",actions:[{label:"Go to invoices",variant:"solid",onClick:l=>{v.push({name:"Invoices"}),l()}}]});else{let l=C;l.stripe_invoice_url?window.open(l.stripe_invoice_url,"_blank"):A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.get_stripe_payment_url_for_invoice",data:{name:l.name}},auto:!0,onSuccess:I=>window.open(I,"_blank")})}}return(C,l)=>{var I,N,R;return s(),d("div",ye,[l[14]||(l[14]=e("div",{class:"text-lg font-semibold text-gray-900"},o("Current plan"),-1)),(I=c.value)!=null&&I.is_trial_plan?(s(),d("div",xe,[e("div",be,[e("div",he,[e("div",Ce,[e("div",we,o(c.value.is_trial_plan?"Trial plan":c.value.name),1),c.value.is_trial_plan?(s(),d("div",ke,o(x.value),1)):b("",!0)]),c.value.is_trial_plan&&c.value.support_included?(s(),d("div",$e,[i(a(M),{class:"h-4",name:"info"}),l[4]||(l[4]=e("span",null," Support Included ",-1))])):(s(),d("div",Ve,[e("span",null,o(P.value)+o(m.value.value),1),l[5]||(l[5]=e("span",{class:"font-normal"},o(" / month · See plan details"),-1))]))])]),i(a(S),{variant:"solid",label:c.value.is_trial_plan?"Upgrade now":"Change plan",onClick:l[0]||(l[0]=E=>y("changePlan"))},null,8,["label"])])):c.value?(s(),d("div",Me,[e("div",De,[e("div",Se,[e("div",Pe,[l[9]||(l[9]=e("div",{class:"font-semibold text-lg"},"Recurring Charges",-1)),e("div",Ae,[l[7]||(l[7]=e("span",null,"Next charge date — ",-1)),e("span",null,o(F()),1),l[8]||(l[8]=e("span",null," · ",-1)),i(a(re),null,{body:h(()=>[i(ie,{plan:c.value},null,8,["plan"])]),default:h(()=>[l[6]||(l[6]=e("span",{class:"hover:underline cursor-pointer"}," See plan details ",-1))]),_:1})])]),e("div",Be,[e("div",null,[e("span",Ie,o(P.value)+o(m.value),1),l[10]||(l[10]=e("span",null,"/mo",-1))]),e("div",je,[e("span",null,o(P.value)+o((m.value/30).toFixed(2)),1),l[11]||(l[11]=e("span",null,"/day",-1))])])]),e("div",Le,[e("div",Ue,[i(ae,{class:"h-4 w-4"}),e("div",null,[l[12]||(l[12]=e("span",null,"Current billing amount so far ",-1)),e("span",Ne,o(P.value)+" "+o(((N=a(p))==null?void 0:N.toFixed(2))||"0.00"),1)])]),e("div",null,[i(a(S),{variant:"solid",label:"Upgrade plan",onClick:l[1]||(l[1]=E=>y("changePlan"))})])])]),a(L).data?(s(),d("div",Re,[e("div",Ee,[i(_e,{class:"h-4 w-4"}),e("div",null,[l[13]||(l[13]=e("span",null,"Unpaid amount is ",-1)),e("span",null,o(P.value)+" "+o((R=a(L).data)==null?void 0:R.toFixed(2)),1)])]),e("div",null,[i(a(S),{variant:"outline",label:"Pay now",onClick:t})])])):b("",!0)])):(s(),d("div",Fe,[i(a(Q),{class:"h-4 w-4 text-gray-700"})])),k.value?(s(),V(X,{key:3,modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=E=>k.value=E),onSuccess:l[3]||(l[3]=E=>a(w).reload())},null,8,["modelValue"])):b("",!0)])}}},Z={__name:"DropdownItem",props:{label:String,active:Boolean,onClick:Array},setup(_){return(n,y)=>(s(),d("div",null,[i(a(S),{class:"flex justify-between w-full rounded text-base",variant:"ghost",label:_.label,onClick:_.onClick},H({_:2},[_.active?{name:"suffix",fn:h(()=>[i(a(M),{class:"size-4",name:"check"})]),key:"0"}:void 0]),1032,["label","onClick"])]))}},Oe={key:0,class:"inline-flex gap-1.5 text-base mb-5 text-gray-700"},Ye={__name:"BillingDetailsModal",props:U({showMessage:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:U(["success"],["update:modelValue"]),setup(_,{emit:n}){const y=n,v=O(_,"modelValue"),r=D(null);return(u,p)=>(s(),V(a(Y),{modelValue:v.value,"onUpdate:modelValue":p[1]||(p[1]=w=>v.value=w),options:{title:"Billing Details"}},{"body-content":h(()=>[_.showMessage?(s(),d("div",Oe,[i(a(M),{class:"h-4",name:"info"}),p[2]||(p[2]=e("span",null," Add billing details to your account before proceeding.",-1))])):b("",!0),i(oe,{ref_key:"billingRef",ref:r,onSuccess:p[0]||(p[0]=()=>{v.value=!1,y("success")})},null,512)]),_:1},8,["modelValue"]))}},ze={key:0,class:"flex flex-col gap-2.5"},Te={class:"flex gap-2"},Ze={class:"flex items-center gap-1 h-7 font-medium"},qe={class:"text-gray-600"},Ge={key:0},Je={__name:"ChangeCardModal",props:{modelValue:{},modelModifiers:{}},emits:U(["success","addCard"],["update:modelValue"]),setup(_,{emit:n}){const y=n,v=O(_,"modelValue"),r=A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.get_payment_methods"},cache:"cards",auto:!0}),u=k=>{A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.set_as_default",data:{name:k}},auto:!0,onSuccess:()=>{r.reload(),y("success")}})},p=D(!1),w=k=>{p.value=!0,G({title:"Remove Card",message:"Are you sure you want to remove this card?",actions:[{label:"Remove",variant:"solid",theme:"red",onClick:f=>{A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.remove_payment_method",data:{name:k}},auto:!0,onSuccess:()=>{r.reload(),p.value=!1,f()}})}}],onClose:()=>{p.value=!1}})};return(k,f)=>(s(),d("div",null,[i(a(Y),{modelValue:v.value,"onUpdate:modelValue":f[1]||(f[1]=x=>v.value=x),options:{title:"Choose active card"},disableOutsideClickToClose:p.value},{"body-content":h(()=>{var x;return[(x=a(r).data)!=null&&x.length?(s(),d("div",ze,[(s(!0),d(z,null,te(a(r).data,m=>(s(),d("div",{key:m.name,class:"flex gap-2 justify-between text-base text-gray-900 p-2.5 rounded hover:bg-gray-100"},[e("div",Te,[(s(),V(J(a(W)(m.brand)),{class:"size-7"})),e("div",null,[e("div",Ze,[e("div",null,o(m.name_on_card),1),f[2]||(f[2]=e("div",null,"·",-1)),f[3]||(f[3]=e("div",null,"Card ending in ••••",-1)),e("div",null,o(m.last_4),1),m.is_default?(s(),V(a(ue),{key:0,class:"ml-1.5",label:"Default",variant:"outline",theme:"green"})):b("",!0)]),e("div",qe," Expiry "+o(m.expiry_month<10?`0${m.expiry_month}`:m.expiry_month)+"/"+o(m.expiry_year),1)])]),a(r).data.length>1&&!m.is_default?(s(),d("div",Ge,[i(a(K),{options:[{label:"Set as default",onClick:()=>u(m.name),condition:()=>!m.is_default},{label:"Remove",onClick:()=>w(m.name)}]},{default:h(()=>[i(a(S),{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])])):b("",!0)]))),128))])):b("",!0)]}),actions:h(()=>[i(a(S),{label:"Add new card",class:"w-full",variant:"solid",onClick:f[0]||(f[0]=x=>y("addCard"))},{prefix:h(()=>[i(a(M),{name:"plus",class:"h-4"})]),_:1})]),_:1},8,["modelValue","disableOutsideClickToClose"])]))}},Ke={class:"flex flex-col gap-4"},Qe={class:"flex flex-col"},We={key:0,class:"flex justify-between items-center text-base text-gray-900"},Xe={class:"flex flex-col gap-1.5"},ea={class:"overflow-hidden text-gray-700 text-ellipsis"},aa={key:0,class:"inline-flex items-center gap-2"},ta={class:"text-gray-700"},la={key:1,class:"text-gray-700"},sa={class:"shrink-0"},na={key:1,class:"bg-gray-100 h-px my-3"},ia={class:"flex justify-between items-center text-base text-gray-900"},oa={class:"flex flex-col gap-1.5"},da={key:0,class:"inline-flex items-center gap-2 text-gray-700"},ra={key:1,class:"text-gray-700"},ua={class:"shrink-0"},pa={class:"flex justify-between items-center text-base text-gray-900"},ca={class:"flex flex-col gap-1.5"},ma={class:"text-gray-700"},va={class:"shrink-0"},fa={class:"flex justify-between items-center text-base text-gray-900"},_a={class:"flex flex-col gap-1.5"},ga={key:0,class:"text-gray-700 leading-5"},ya={key:1,class:"text-gray-700"},xa={class:"shrink-0"},ba={__name:"PaymentDetails",setup(_){const n=j("team"),{availableCredits:y,upcomingInvoice:v}=j("billing"),r=D(!1),u=D(!1),p=D(!1),w=D(!1),k=B(()=>n.data.currency=="INR"?"₹":"$"),f=A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.get_information"},cache:"billingDetails",auto:!0}),x=B(()=>{let $=f.data;if(!$)return"";const{billing_name:t,address_line1:g,city:C,state:l,country:I,pincode:N,gstin:R}=$||{};return[t,g,C,l,I,N,R].filter(Boolean).join(", ")}),m=[{label:"Card",value:"Card",description:"Your card will be charged for monthly subscription",component:()=>T(Z,{label:"Card",active:n.data.payment_mode==="Card",onClick:()=>L("Card")})},{label:"Prepaid credits",value:"Prepaid Credits",description:"You will be charged from your credit balance for monthly subscription",component:()=>T(Z,{label:"Prepaid credits",active:n.data.payment_mode==="Prepaid Credits",onClick:()=>L("Prepaid Credits")})}],P=B(()=>m.find($=>$.value===n.data.payment_mode)),c=D(!1);function L($){if(c.value=!1,!x.value){c.value=!0,r.value=!0;return}if($==="Prepaid Credits"&&n.data.balance===0){c.value=!0,u.value=!0;return}else $==="Card"&&!n.data.payment_method&&(c.value=!0,p.value=!0);A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.change_payment_mode",data:{mode:$}},auto:!0,onSuccess:()=>n.reload()})}function F(){n.data.payment_method?w.value=!0:(c.value=!1,p.value=!0)}return($,t)=>(s(),d(z,null,[e("div",Ke,[t[18]||(t[18]=e("div",{class:"text-lg font-semibold text-gray-900"},o("Payment details"),-1)),e("div",Qe,[a(n).data.payment_mode=="Card"?(s(),d("div",We,[e("div",Xe,[t[12]||(t[12]=e("div",{class:"font-medium"},o("Active card"),-1)),e("div",ea,[a(n).data.payment_method?(s(),d("div",aa,[(s(),V(J(a(W)(a(n).data.payment_method.brand)))),e("div",ta,[e("span",null,o(a(n).data.payment_method.name_on_card),1),t[11]||(t[11]=e("span",null," · Card ending in •••• ",-1)),e("span",null,o(a(n).data.payment_method.last_4),1)])])):(s(),d("span",la,"No card added"))])]),e("div",sa,[i(a(S),{label:a(n).data.payment_method?"Change card":"Add card",onClick:F},H({_:2},[a(n).data.payment_method?void 0:{name:"prefix",fn:h(()=>[i(a(M),{class:"h-4",name:"plus"})]),key:"0"}]),1032,["label"])])])):b("",!0),a(n).data.payment_mode=="Card"?(s(),d("div",na)):b("",!0),e("div",ia,[e("div",oa,[t[13]||(t[13]=e("div",{class:"font-medium"},o("Mode of payment"),-1)),a(n).data.payment_mode?(s(),d("div",da,[i(a(M),{class:"h-4",name:"info"}),le(" "+o(P.value.description),1)])):(s(),d("span",ra,"Not set"))]),e("div",ua,[i(a(K),{options:m},{default:h(({open:g})=>[i(a(S),{label:a(n).data.payment_mode?P.value.label:"Set mode"},{suffix:h(()=>[i(a(M),{name:g?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1})])]),t[16]||(t[16]=e("div",{class:"bg-gray-100 h-px my-3"},null,-1)),e("div",pa,[e("div",ca,[t[14]||(t[14]=e("div",{class:"font-medium"},o("Credit balance"),-1)),e("div",ma,o(a(y)||k.value+" 0.00"),1)]),e("div",va,[i(a(S),{label:"Add credit",onClick:t[0]||(t[0]=()=>{if(c.value=!1,!x.value){c.value=!0,r.value=!0;return}u.value=!0})},{prefix:h(()=>[i(a(M),{class:"h-4",name:"plus"})]),_:1})])]),t[17]||(t[17]=e("div",{class:"bg-gray-100 h-px my-3"},null,-1)),e("div",fa,[e("div",_a,[t[15]||(t[15]=e("div",{class:"font-medium"},o("Billing address"),-1)),x.value?(s(),d("div",ga,o(x.value),1)):(s(),d("div",ya,"No address"))]),e("div",xa,[i(a(S),{label:x.value?"Edit information":"Add billing address",onClick:t[1]||(t[1]=()=>{c.value=!1,r.value=!0})},H({_:2},[x.value?void 0:{name:"prefix",fn:h(()=>[i(a(M),{class:"h-4",name:"plus"})]),key:"0"}]),1032,["label"])])])])]),r.value?(s(),V(Ye,{key:0,modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=g=>r.value=g),showMessage:c.value,onSuccess:t[3]||(t[3]=g=>a(f).reload())},null,8,["modelValue","showMessage"])):b("",!0),u.value?(s(),V(X,{key:1,modelValue:u.value,"onUpdate:modelValue":t[4]||(t[4]=g=>u.value=g),showMessage:c.value,onSuccess:t[5]||(t[5]=g=>a(v).reload())},null,8,["modelValue","showMessage"])):b("",!0),p.value?(s(),V(ce,{key:2,modelValue:p.value,"onUpdate:modelValue":t[6]||(t[6]=g=>p.value=g),showMessage:c.value,onSuccess:t[7]||(t[7]=()=>{c.value=!1,p.value=!1,a(n).reload()})},null,8,["modelValue","showMessage"])):b("",!0),w.value?(s(),V(Je,{key:3,modelValue:w.value,"onUpdate:modelValue":t[8]||(t[8]=g=>w.value=g),onAddCard:t[9]||(t[9]=()=>{w.value=!1,p.value=!0}),onSuccess:t[10]||(t[10]=()=>a(n).reload())},null,8,["modelValue"])):b("",!0)],64))}},ha={class:"flex h-10.5 border-b items-center justify-between py-2 px-5 shrink-0"},Ca={key:0,class:"flex flex-1 flex-col px-60 pt-6 gap-8 overflow-y-auto"},wa={key:1,class:"flex flex-1 items-center justify-center"},Sa={__name:"Overview",setup(_){const n=q(),y=j("team"),v=A({url:"frappe.integrations.frappe_providers.frappecloud_billing.api",params:{method:"billing.upcoming_invoice"},cache:"upcomingInvoice",auto:!0});return se("billing",{upcomingInvoice:v,availableCredits:B(()=>{var r;return(r=v.data)==null?void 0:r.available_credits}),currentBillingAmount:B(()=>{var r,u;return(u=(r=v.data)==null?void 0:r.upcoming_invoice)==null?void 0:u.total})}),(r,u)=>(s(),d(z,null,[e("header",ha,[i(a(pe),{items:[{label:"Billing Overview"}]})]),a(y).data?(s(),d("div",Ca,[i(He,{onChangePlan:u[0]||(u[0]=p=>a(n).push({name:"Plans"}))}),i(ba)])):(s(),d("div",wa,[i(a(Q),{class:"size-8"})]))],64))}};export{Sa as default};
//# sourceMappingURL=Overview-23ab5211.js.map
