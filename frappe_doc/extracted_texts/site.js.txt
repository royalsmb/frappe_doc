// Copyright (c) 2024, reformiqo and contributors
// For license information, please see license.txt

frappe.ui.form.on("Site", {
    refresh(frm) {
        // Add a button to open site URL in a new tab
        frm.add_custom_button(__('Open Site'), function() {
            window.open("https://erpera" + frm.doc.name + ".frappe.cloud", "_blank");
        });

        // Add another button to login as an admin with black color
        frm.add_custom_button(__('Login as Admin'), function() {
            // Call an API to login as an admin
            frappe.call({
                method: "reformiqo.utils.login_as_an_admin",
                args: {
                    site_nsme: "erpera" + frm.doc.name + ".frappe.cloud"
                },
                callback: function(r) {
                console.log(r.message.message)
                    if (r.message) {
                        let url = "https://" + r.message.message.site + "?sid=" + r.message.message.sid;
                        window.open(url, "_blank");
                    }
                }
            });
        }); // Added 'btn-dark' class for black button
    },
    plan: function(frm) {
        frm.set_value("start_date", frappe.datetime.get_today());
        frappe.call({
            method: "reformiqo.api.get_plan_info",
            args: {
                plan_id: frm.doc.plan
            },
            callback: function(r) {
                if (r.message) {
                    frm.set_value("end_date", r.message);
                    frm.refresh_field("end_date");
                }
            }
        })
        }
});
